# 寄付機能のセットアップガイド

## 概要

このアプリには、Google Play Billingを使用した寄付機能が実装されています。ユーザーは10円から10,000円までの任意の金額で開発を支援できます。

## Google Play Consoleでの設定

### 1. 商品IDの作成

Google Play Consoleで以下の商品IDを作成する必要があります：

- `donation_10` - 10円
- `donation_50` - 50円
- `donation_100` - 100円
- `donation_500` - 500円
- `donation_1000` - 1000円
- `donation_5000` - 5000円
- `donation_10000` - 10000円

### 2. 商品の設定手順

1. Google Play Consoleにログイン
2. アプリを選択
3. **収益化** → **アプリ内商品** に移動
4. **商品を作成** をクリック
5. 商品タイプ: **消費型アイテム** を選択
6. 商品IDを入力（例: `donation_10`）
7. 名前: 「開発支援 - 10円」
8. 説明: 「このアプリの開発を支援」
9. 価格: 10円に設定
10. **保存** をクリック

各金額について同様の手順を繰り返します。

### 3. テスト用ライセンスキーの設定

1. Google Play Consoleで **設定** → **ライセンステスト** に移動
2. **ライセンステストレスポンダー** にテスト用のGmailアドレスを追加
3. テスト用アカウントでアプリをインストールしてテスト

## 実装の詳細

### 金額の選択

ユーザーが入力した金額に最も近い商品IDが自動的に選択されます：

- 10円以下 → `donation_10`
- 11-50円 → `donation_50`
- 51-100円 → `donation_100`
- 101-500円 → `donation_500`
- 501-1000円 → `donation_1000`
- 1001-5000円 → `donation_5000`
- 5001円以上 → `donation_10000`

### 購入フロー

1. ユーザーが金額を入力または選択
2. 「寄付する」ボタンをタップ
3. Google Playの購入ダイアログが表示
4. 購入が完了すると自動的に確認（acknowledge）される
5. 成功メッセージが表示される

## テスト

### テスト用アカウント

1. Google Play Consoleでテスト用アカウントを設定
2. テスト用アカウントでアプリをインストール
3. 寄付ページでテスト購入を実行
4. 購入が正常に完了することを確認

### 注意事項

- テスト環境では実際の課金は行われません
- 本番環境にリリースする前に、必ずテストを完了してください
- 商品IDは正確に設定されているか確認してください

## トラブルシューティング

### エラー: "Product not found"

- Google Play Consoleで商品IDが正しく設定されているか確認
- 商品が「アクティブ」状態になっているか確認
- アプリのバージョンが正しくアップロードされているか確認

### エラー: "Billing not ready"

- Google Playサービスが最新バージョンか確認
- インターネット接続を確認
- アプリがGoogle Playストアからインストールされているか確認

### 購入が完了しない

- テスト用アカウントが正しく設定されているか確認
- Google Play Consoleの設定を確認
- ログを確認してエラーの詳細を確認

## 規約への準拠

この実装は、Google Playの以下の規約に準拠しています：

1. **消費型アイテム**: 寄付は消費型アイテムとして実装
2. **購入の確認**: 購入後、自動的に確認（acknowledge）される
3. **明確な説明**: ユーザーに寄付の目的と金額が明確に表示される
4. **任意性**: 寄付は任意であり、アプリの機能は無料で利用可能

## 参考資料

- [Google Play Billing Library ドキュメント](https://developer.android.com/google/play/billing)
- [Google Play Console ヘルプ](https://support.google.com/googleplay/android-developer/)

